/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Directive, ElementRef, Inject, Input, } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { normalizeInputAsBoolean } from './utils';
import { AutofocusFixConfig } from './autofocus-fix-config';
// @todo: check configuration
/**
 * ## Ways to turn off autofocus: any js-falsely value, except empty string
 *
 *     <!-- with data binding -->
 *     <input [autofocus]=""> <!-- undefined value -->
 *     <input [autofocus]="undefined">
 *     <input [autofocus]="false">
 *     <input [autofocus]="null">
 *     <input [autofocus]="0">
 *     <input [autofocus]="NaN">
 *
 *     <!-- without data binding -->
 *     <input autofocus="undefined">
 *     <input autofocus="false">
 *     <input autofocus="null">
 *     <input autofocus="0">
 *     <input autofocus="NaN">
 *
 *     <input> <!-- disabled by default -->
 *
 *
 * ## Ways to enable autofocus: any js-true value and empty string
 *
 *     <!-- empty string will enable autofocus, this is default html behavior -->
 *     <input [autofocus]="''">
 *     <input autofocus="">
 *     <input autofocus>
 *
 *     <input [autofocus]="true">
 *     <input autofocus="true">
 *
 *     <input [autofocus]="'any other values'">
 *
 * \@dynamic
 * Notice: \@dynamic used for correctly Document inject
 *         https://github.com/angular/angular/issues/20351
 */
export class AutofocusFixDirective {
    /**
     * @param {?} $er
     * @param {?} $cdr
     * @param {?} $document
     * @param {?} $config
     */
    constructor($er, $cdr, $document, $config) {
        this.$cdr = $cdr;
        this.$document = $document;
        this.$config = $config;
        this.wasInitialized = false;
        /**
         * Notice: protected for unit testing
         */
        this.localConfig = {};
        this.autofocusEnabled = false;
        this.element = $er.nativeElement;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // Autofocus works only once. No need to do the initialization on each change detection cycle.
        if (this.wasInitialized) {
            return;
        }
        this.normalizeLocalConfigItem('async', changes.autofocusFixAsync);
        this.normalizeLocalConfigItem('smartEmptyCheck', changes.autofocusFixSmartEmptyCheck);
        this.normalizeLocalConfigItem('triggerDetectChanges', changes.autofocusFixTriggerDetectChanges);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.element.focus) {
            return console.warn('AutofocusFixDirective: There is no .focus() method on the element: %O', this.element);
        }
        this.config = (/** @type {?} */ ({}));
        AutofocusFixConfig.keys.forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            /** @type {?} */
            const local = this.localConfig[key];
            this.config[key] = local !== undefined ? local : this.$config[key];
        }));
        this.autofocusEnabled = normalizeInputAsBoolean(this.autofocus, this.config.smartEmptyCheck);
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.wasInitialized = true;
        if (!this.element.focus) {
            return;
        }
        this.checkFocus();
    }
    /**
     * @private
     * @return {?}
     */
    checkFocus() {
        this.config.async ? setTimeout(this.checkFocusInternal.bind(this)) : this.checkFocusInternal();
    }
    /**
     * @private
     * @return {?}
     */
    checkFocusInternal() {
        if (!this.autofocusEnabled || this.amIFocused) {
            return;
        }
        this.element.focus();
        if (this.config.triggerDetectChanges) {
            this.$cdr.detectChanges();
        }
    }
    /**
     * @private
     * @return {?}
     */
    get amIFocused() {
        return this.$document.activeElement === this.element;
    }
    /**
     * @private
     * @param {?} configKey
     * @param {?=} change
     * @return {?}
     */
    normalizeLocalConfigItem(configKey, change) {
        if (change) {
            this.localConfig[configKey] = normalizeInputAsBoolean(change.currentValue);
        }
    }
}
AutofocusFixDirective.decorators = [
    { type: Directive, args: [{
                selector: '[autofocus]',
            },] }
];
/** @nocollapse */
AutofocusFixDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Document, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: AutofocusFixConfig }
];
AutofocusFixDirective.propDecorators = {
    autofocus: [{ type: Input }],
    autofocusFixSmartEmptyCheck: [{ type: Input }],
    autofocusFixTriggerDetectChanges: [{ type: Input }],
    autofocusFixAsync: [{ type: Input }]
};
if (false) {
    /**
     * Raw value. Always have default value: ''
     * @type {?}
     */
    AutofocusFixDirective.prototype.autofocus;
    /**
     * @see {\@link AutofocusFixConfig.smartEmptyCheck}
     * @type {?}
     */
    AutofocusFixDirective.prototype.autofocusFixSmartEmptyCheck;
    /**
     * @see {\@link AutofocusFixConfig.triggerDetectChanges}
     * @type {?}
     */
    AutofocusFixDirective.prototype.autofocusFixTriggerDetectChanges;
    /**
     * @see {\@link AutofocusFixConfig.async}
     * @type {?}
     */
    AutofocusFixDirective.prototype.autofocusFixAsync;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.wasInitialized;
    /**
     * Notice: protected for unit testing
     * @type {?}
     * @protected
     */
    AutofocusFixDirective.prototype.localConfig;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.config;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.autofocusEnabled;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.element;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.$cdr;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.$document;
    /**
     * @type {?}
     * @private
     */
    AutofocusFixDirective.prototype.$config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2ZvY3VzLWZpeC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtYXV0b2ZvY3VzLWZpeC8iLCJzb3VyY2VzIjpbImxpYi9hdXRvZm9jdXMtZml4LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLE1BQU0sRUFDTixLQUFLLEdBR04sTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE9BQU8sRUFBRSx1QkFBdUIsRUFBMkIsTUFBTSxTQUFTLENBQUM7QUFDM0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRDNUQsTUFBTSxPQUFPLHFCQUFxQjs7Ozs7OztJQXlCaEMsWUFDRSxHQUFlLEVBQ0UsSUFBdUIsRUFFdkIsU0FBbUIsRUFDbkIsT0FBMkI7UUFIM0IsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFFdkIsY0FBUyxHQUFULFNBQVMsQ0FBVTtRQUNuQixZQUFPLEdBQVAsT0FBTyxDQUFvQjtRQVp0QyxtQkFBYyxHQUFHLEtBQUssQ0FBQzs7OztRQUVyQixnQkFBVyxHQUF1QyxFQUFFLENBQUM7UUFFdkQscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBVS9CLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQztJQUNuQyxDQUFDOzs7OztJQUVNLFdBQVcsQ0FBQyxPQUFnRTtRQUNqRiw4RkFBOEY7UUFDOUYsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQUUsT0FBTztTQUFFO1FBRXBDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDbEUsSUFBSSxDQUFDLHdCQUF3QixDQUFDLGlCQUFp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Ozs7OztJQUNwQyx3Q0FBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsIE9uSW5pdCxcbiAgU2ltcGxlQ2hhbmdlLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuaW1wb3J0IHsgbm9ybWFsaXplSW5wdXRBc0Jvb2xlYW4sIE11dGFibGVQYXJ0aWFsLCBNdXRhYmxlIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBBdXRvZm9jdXNGaXhDb25maWcgfSBmcm9tICcuL2F1dG9mb2N1cy1maXgtY29uZmlnJztcblxuLy8gQHRvZG86IGNoZWNrIGNvbmZpZ3VyYXRpb25cblxuLyoqXG4gKiAjIyBXYXlzIHRvIHR1cm4gb2ZmIGF1dG9mb2N1czogYW55IGpzLWZhbHNlbHkgdmFsdWUsIGV4Y2VwdCBlbXB0eSBzdHJpbmdcbiAqXG4gKiAgICAgPCEtLSB3aXRoIGRhdGEgYmluZGluZyAtLT5cbiAqICAgICA8aW5wdXQgW2F1dG9mb2N1c109XCJcIj4gPCEtLSB1bmRlZmluZWQgdmFsdWUgLS0+XG4gKiAgICAgPGlucHV0IFthdXRvZm9jdXNdPVwidW5kZWZpbmVkXCI+XG4gKiAgICAgPGlucHV0IFthdXRvZm9jdXNdPVwiZmFsc2VcIj5cbiAqICAgICA8aW5wdXQgW2F1dG9mb2N1c109XCJudWxsXCI+XG4gKiAgICAgPGlucHV0IFthdXRvZm9jdXNdPVwiMFwiPlxuICogICAgIDxpbnB1dCBbYXV0b2ZvY3VzXT1cIk5hTlwiPlxuICpcbiAqICAgICA8IS0tIHdpdGhvdXQgZGF0YSBiaW5kaW5nIC0tPlxuICogICAgIDxpbnB1dCBhdXRvZm9jdXM9XCJ1bmRlZmluZWRcIj5cbiAqICAgICA8aW5wdXQgYXV0b2ZvY3VzPVwiZmFsc2VcIj5cbiAqICAgICA8aW5wdXQgYXV0b2ZvY3VzPVwibnVsbFwiPlxuICogICAgIDxpbnB1dCBhdXRvZm9jdXM9XCIwXCI+XG4gKiAgICAgPGlucHV0IGF1dG9mb2N1cz1cIk5hTlwiPlxuICpcbiAqICAgICA8aW5wdXQ+IDwhLS0gZGlzYWJsZWQgYnkgZGVmYXVsdCAtLT5cbiAqXG4gKlxuICogIyMgV2F5cyB0byBlbmFibGUgYXV0b2ZvY3VzOiBhbnkganMtdHJ1ZSB2YWx1ZSBhbmQgZW1wdHkgc3RyaW5nXG4gKlxuICogICAgIDwhLS0gZW1wdHkgc3RyaW5nIHdpbGwgZW5hYmxlIGF1dG9mb2N1cywgdGhpcyBpcyBkZWZhdWx0IGh0bWwgYmVoYXZpb3IgLS0+XG4gKiAgICAgPGlucHV0IFthdXRvZm9jdXNdPVwiJydcIj5cbiAqICAgICA8aW5wdXQgYXV0b2ZvY3VzPVwiXCI+XG4gKiAgICAgPGlucHV0IGF1dG9mb2N1cz5cbiAqXG4gKiAgICAgPGlucHV0IFthdXRvZm9jdXNdPVwidHJ1ZVwiPlxuICogICAgIDxpbnB1dCBhdXRvZm9jdXM9XCJ0cnVlXCI+XG4gKlxuICogICAgIDxpbnB1dCBbYXV0b2ZvY3VzXT1cIidhbnkgb3RoZXIgdmFsdWVzJ1wiPlxuICpcbiAqIEBkeW5hbWljXG4gKiBOb3RpY2U6IEBkeW5hbWljIHVzZWQgZm9yIGNvcnJlY3RseSBEb2N1bWVudCBpbmplY3RcbiAqICAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMjAzNTFcbiAqL1xuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2F1dG9mb2N1c10nLFxufSlcbmV4cG9ydCBjbGFzcyBBdXRvZm9jdXNGaXhEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCB7XG5cbiAgLyoqIFJhdyB2YWx1ZS4gQWx3YXlzIGhhdmUgZGVmYXVsdCB2YWx1ZTogJycgKi9cbiAgQElucHV0KClcbiAgcHVibGljIGF1dG9mb2N1czogYW55O1xuXG4gIC8qKiBAc2VlIHtAbGluayBBdXRvZm9jdXNGaXhDb25maWcuc21hcnRFbXB0eUNoZWNrfSAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgYXV0b2ZvY3VzRml4U21hcnRFbXB0eUNoZWNrPzogYm9vbGVhbiB8IGFueTtcblxuICAvKiogQHNlZSB7QGxpbmsgQXV0b2ZvY3VzRml4Q29uZmlnLnRyaWdnZXJEZXRlY3RDaGFuZ2VzfSAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgYXV0b2ZvY3VzRml4VHJpZ2dlckRldGVjdENoYW5nZXM/OiBib29sZWFuIHwgYW55O1xuXG4gIC8qKiBAc2VlIHtAbGluayBBdXRvZm9jdXNGaXhDb25maWcuYXN5bmN9ICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBhdXRvZm9jdXNGaXhBc3luYz86IGJvb2xlYW4gfCBhbnk7XG5cbiAgcHJpdmF0ZSB3YXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICAvKiogTm90aWNlOiBwcm90ZWN0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xuICBwcm90ZWN0ZWQgbG9jYWxDb25maWc6IE11dGFibGVQYXJ0aWFsPEF1dG9mb2N1c0ZpeENvbmZpZz4gPSB7fTtcbiAgcHJpdmF0ZSBjb25maWchOiBNdXRhYmxlPEF1dG9mb2N1c0ZpeENvbmZpZz47XG4gIHByaXZhdGUgYXV0b2ZvY3VzRW5hYmxlZCA9IGZhbHNlO1xuICBwcml2YXRlIHJlYWRvbmx5IGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihcbiAgICAkZXI6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSByZWFkb25seSAkY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBASW5qZWN0KERPQ1VNRU5UKVxuICAgIHByaXZhdGUgcmVhZG9ubHkgJGRvY3VtZW50OiBEb2N1bWVudCxcbiAgICBwcml2YXRlIHJlYWRvbmx5ICRjb25maWc6IEF1dG9mb2N1c0ZpeENvbmZpZyxcbiAgKSB7XG4gICAgdGhpcy5lbGVtZW50ID0gJGVyLm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogeyBba2V5IGluIGtleW9mIEF1dG9mb2N1c0ZpeERpcmVjdGl2ZV0/OiBTaW1wbGVDaGFuZ2UgfSk6IHZvaWQge1xuICAgIC8vIEF1dG9mb2N1cyB3b3JrcyBvbmx5IG9uY2UuIE5vIG5lZWQgdG8gZG8gdGhlIGluaXRpYWxpemF0aW9uIG9uIGVhY2ggY2hhbmdlIGRldGVjdGlvbiBjeWNsZS5cbiAgICBpZiAodGhpcy53YXNJbml0aWFsaXplZCkgeyByZXR1cm47IH1cblxuICAgIHRoaXMubm9ybWFsaXplTG9jYWxDb25maWdJdGVtKCdhc3luYycsIGNoYW5nZXMuYXV0b2ZvY3VzRml4QXN5bmMpO1xuICAgIHRoaXMubm9ybWFsaXplTG9jYWxDb25maWdJdGVtKCdzbWFydEVtcHR5Q2hlY2snLCBjaGFuZ2VzLmF1dG9mb2N1c0ZpeFNtYXJ0RW1wdHlDaGVjayk7XG4gICAgdGhpcy5ub3JtYWxpemVMb2NhbENvbmZpZ0l0ZW0oJ3RyaWdnZXJEZXRlY3RDaGFuZ2VzJywgY2hhbmdlcy5hdXRvZm9jdXNGaXhUcmlnZ2VyRGV0ZWN0Q2hhbmdlcyk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmVsZW1lbnQuZm9jdXMpIHtcbiAgICAgIHJldHVybiBjb25zb2xlLndhcm4oXG4gICAgICAgICdBdXRvZm9jdXNGaXhEaXJlY3RpdmU6IFRoZXJlIGlzIG5vIC5mb2N1cygpIG1ldGhvZCBvbiB0aGUgZWxlbWVudDogJU8nLFxuICAgICAgICB0aGlzLmVsZW1lbnQsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuY29uZmlnID0ge30gYXMgQXV0b2ZvY3VzRml4Q29uZmlnO1xuICAgIEF1dG9mb2N1c0ZpeENvbmZpZy5rZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGNvbnN0IGxvY2FsID0gdGhpcy5sb2NhbENvbmZpZ1trZXldO1xuICAgICAgdGhpcy5jb25maWdba2V5XSA9IGxvY2FsICE9PSB1bmRlZmluZWQgPyBsb2NhbCA6IHRoaXMuJGNvbmZpZ1trZXldO1xuICAgIH0pO1xuXG4gICAgdGhpcy5hdXRvZm9jdXNFbmFibGVkID0gbm9ybWFsaXplSW5wdXRBc0Jvb2xlYW4odGhpcy5hdXRvZm9jdXMsIHRoaXMuY29uZmlnLnNtYXJ0RW1wdHlDaGVjayk7XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMud2FzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIGlmICghdGhpcy5lbGVtZW50LmZvY3VzKSB7IHJldHVybjsgfVxuXG4gICAgdGhpcy5jaGVja0ZvY3VzKCk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRm9jdXMoKTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcuYXN5bmMgPyBzZXRUaW1lb3V0KHRoaXMuY2hlY2tGb2N1c0ludGVybmFsLmJpbmQodGhpcykpIDogdGhpcy5jaGVja0ZvY3VzSW50ZXJuYWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tGb2N1c0ludGVybmFsKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5hdXRvZm9jdXNFbmFibGVkIHx8IHRoaXMuYW1JRm9jdXNlZCkgeyByZXR1cm47IH1cblxuICAgIHRoaXMuZWxlbWVudC5mb2N1cygpO1xuICAgIGlmICh0aGlzLmNvbmZpZy50cmlnZ2VyRGV0ZWN0Q2hhbmdlcykge1xuICAgICAgdGhpcy4kY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldCBhbUlGb2N1c2VkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLiRkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLmVsZW1lbnQ7XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZUxvY2FsQ29uZmlnSXRlbShjb25maWdLZXk6IGtleW9mIEF1dG9mb2N1c0ZpeENvbmZpZywgY2hhbmdlPzogU2ltcGxlQ2hhbmdlKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZSkge1xuICAgICAgdGhpcy5sb2NhbENvbmZpZ1tjb25maWdLZXldID0gbm9ybWFsaXplSW5wdXRBc0Jvb2xlYW4oY2hhbmdlLmN1cnJlbnRWYWx1ZSk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==